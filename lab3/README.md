This code has been written under severe time constraints, hence, it may have critical bugs, and is not very readable.

I intend to clean it up soon.

